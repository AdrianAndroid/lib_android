(window.webpackJsonpLogan=window.webpackJsonpLogan||[]).push([[3],{10:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n(12),a=n(0),i=function(){},u=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},c=function(e,t,n,r,o){return u(void 0,void 0,void 0,(function(){return s(this,(function(a){return[2,new Promise((function(a,u){!function(e){var t="XDomainRequest"in window,n=t?new window.XDomainRequest:new XMLHttpRequest;if(n.open(e.type||"GET",e.url,!0),n.success=e.success||i,n.fail=e.fail||i,n.withCredentials=e.withCredentials,t?(n.onload=e.success||i,n.onerror=e.fail||i,n.onprogress=i):n.onreadystatechange=function(){if(4===n.readyState){var t=n.status;t>=200?e.success&&e.success(n.responseText):e.fail&&e.fail("Request failed, status: "+t+", responseText: "+n.responseText)}},"POST"===e.type){if(e.headers&&!t)for(var r in e.headers)n.setRequestHeader(r,e.headers[r]);n.send(e.data)}else n.send()}({url:e,type:r||"GET",data:t,withCredentials:!!n,headers:o,success:function(e){a(e)},fail:function(e){u(new Error(e||"Request failed"))}})}))]}))}))},l=n(2),f=n(13);n.d(t,"default",(function(){return b}));var p,d=function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},h=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))},g=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};function b(e){return h(this,void 0,void 0,(function(){var t=this;return g(this,(function(n){switch(n.label){case 0:if(o.b.idbIsSupported())return[3,1];throw new Error(r.b.DB_NOT_SUPPORT);case 1:return p||(p=new o.b(a.a.get("dbName"))),[4,Object(f.a)((function(){return h(t,void 0,void 0,(function(){var t,n,i,u,s,f,b,y,w,v;return g(this,(function(m){switch(m.label){case 0:return[4,p.getLogDaysInfo(e.fromDayString,e.toDayString)];case 1:t=m.sent(),n=t.reduce((function(e,t){var n;return d(((n={})[t[o.a]]=t.reportPagesInfo?t.reportPagesInfo.pageSizes.map((function(e,n){return p.logReportNameFormatter(t[o.a],n)})):[],n),e)}),{}),i={},u=Object(l.d)(e.fromDayString),s=Object(l.d)(e.toDayString),f=+u,m.label=2;case 2:if(!(f<=+s))return[3,14];if(b=Object(l.c)(new Date(f)),!(n[b]&&n[b].length>0))return[3,12];m.label=3;case 3:return m.trys.push([3,10,,11]),[4,Promise.all(n[b].map((function(t){return function(e,t){var n;return h(this,void 0,void 0,(function(){var o,i,u,s,l;return g(this,(function(f){switch(f.label){case 0:return[4,p.getLogsByReportName(e)];case 1:return(o=f.sent()).length>0?(i=p.logReportNameParser(e).pageIndex,u=o.map((function(e){return encodeURIComponent(e.logString)})),s=p.logReportNameParser(e),l="function"==typeof t.xhrOptsFormatter?t.xhrOptsFormatter(u,s.pageIndex+1,s.logDay):{},[4,c(l.reportUrl||t.reportUrl||a.a.get("reportUrl"),l.data||JSON.stringify({client:"Web",webSource:""+(t.webSource||""),deviceId:t.deviceId,environment:""+(t.environment||""),customInfo:""+(t.customInfo||""),logPageNo:s.pageIndex+1,fileDate:s.logDay,logArray:o.map((function(e){return encodeURIComponent(e.logString)})).toString()}),(n=l.withCredentials,null!=n&&n),"POST",l.headers||{"Content-Type":"application/json",Accept:"application/json,text/javascript"}).then((function(e){var t,n;if("function"==typeof l.responseDealer){var o=l.responseDealer(e);if(o.resultMsg===r.b.REPORT_LOG_SUCC)return i;throw new Error(o.desc)}var a=void 0;try{a=JSON.parse(e)}catch(t){throw new Error("Try to parse response failed, responseText: "+e)}if(200===(null===(t=a)||void 0===t?void 0:t.code))return i;throw new Error("Server error, code: "+(null===(n=a)||void 0===n?void 0:n.code))}))]):[3,3];case 2:return[2,f.sent()];case 3:return[2,Promise.resolve(null)]}}))}))}(t,e)})))];case 4:y=m.sent(),i[b]={msg:r.b.REPORT_LOG_SUCC},m.label=5;case 5:return m.trys.push([5,8,,9]),(w=y.filter((function(e){return null!==e}))).length>0&&e.incrementalReport?[4,p.incrementalDelete(b,w)]:[3,7];case 6:m.sent(),m.label=7;case 7:return[3,9];case 8:return m.sent(),[3,9];case 9:return[3,11];case 10:return v=m.sent(),i[b]={msg:r.b.REPORT_LOG_FAIL,desc:v.message||v.stack||JSON.stringify(v)},[3,11];case 11:return[3,13];case 12:i[b]={msg:r.b.NO_LOG},m.label=13;case 13:return f+=l.b,[3,2];case 14:return[2,i]}}))}))}))];case 2:return[2,n.sent()]}}))}))}},12:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(16),o=n(2),a=n(1),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},c="logDay",l=7*o.a,f=1*o.a,p=function(){function e(e){var t;this.DB=new r.CustomDB({dbName:e||"logan_web_db",dbVersion:1,tables:(t={},t.logan_detail_table={indexList:[{indexName:"logReportName",unique:!1},{indexName:"logCreateTime",unique:!1}]},t.log_day_table={primaryKey:c},t)})}return e.prototype.logReportNameFormatter=function(e,t){return e+"_"+t},e.prototype.logReportNameParser=function(e){var t=e.split("_");return{logDay:t[0],pageIndex:+t[1]}},e.prototype.getLogDayInfo=function(e){return u(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.DB.getItem("log_day_table",e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getLogDaysInfo=function(e,t){return u(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return e!==t?[3,2]:[4,this.DB.getItem("log_day_table",e)];case 1:return[2,(n=r.sent())?[n]:[]];case 2:return[4,this.DB.getItemsInRange({tableName:"log_day_table",indexRange:{indexName:c,lowerIndex:e,upperIndex:t,lowerExclusive:!1,upperExclusive:!1}})];case 3:return[2,r.sent()]}}))}))},e.prototype.getLogsByReportName=function(e){return u(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.DB.getItemsInRange({tableName:"logan_detail_table",indexRange:{indexName:"logReportName",onlyIndex:e}})];case 1:return[2,t.sent()]}}))}))},e.prototype.addLog=function(e){return u(this,void 0,void 0,(function(){var t,n,r,i,u,p,d,h,g,b,y,w,v,m,x;return s(this,(function(s){switch(s.label){case 0:return t=Object(o.g)(e),n=new Date,r=Object(o.c)(n),[4,this.getLogDayInfo(r)];case 1:if((i=s.sent()||((v={})[c]=r,v.totalSize=0,v.reportPagesInfo={pageSizes:[0]},v)).totalSize+t>l)throw new Error(a.b.EXCEED_LOG_SIZE_LIMIT);return i.reportPagesInfo&&i.reportPagesInfo.pageSizes||(i.reportPagesInfo={pageSizes:[0]}),u=i.reportPagesInfo.pageSizes,p=u.length-1,d=u[p],h=d>0&&d+t>f,I=u.slice(),h?I.push(t):I[p]+=t,g=I,(m={}).logReportName=this.logReportNameFormatter(r,h?p+1:p),m.logCreateTime=+n,m.logSize=t,m.logString=e,b=m,(x={})[c]=r,x.totalSize=i.totalSize+t,x.reportPagesInfo={pageSizes:g},y=x,w=6048e5-(+new Date-Object(o.e)(new Date)),[4,this.DB.addItems([{tableName:"log_day_table",item:y,itemDuration:w},{tableName:"logan_detail_table",item:b,itemDuration:w}])];case 2:return s.sent(),[2]}var I}))}))},e.prototype.incrementalDelete=function(e,t){return u(this,void 0,void 0,(function(){var n,r,a,u,c,l,f,p,d,h,g;return s(this,(function(s){switch(s.label){case 0:return[4,this.getLogDayInfo(e)];case 1:return(n=s.sent())&&n.reportPagesInfo&&n.reportPagesInfo.pageSizes instanceof Array?(r=n.reportPagesInfo.pageSizes,a=n.totalSize,u=r.reduce((function(e,n,r){return t.indexOf(r)>=0?e+n:e}),0),c=t.indexOf(r.length-1)>=0?r.concat([0]):r,l=c.reduce((function(e,n,r){return t.indexOf(r)>=0?e.concat([0]):e.concat([n])}),[]),f=i(i({},n),{reportPagesInfo:{pageSizes:l},totalSize:Math.max(a-u,0)}),p=6048e5-(+new Date-Object(o.e)(new Date))-(Object(o.e)(new Date)-Object(o.d)(e).getTime()),[4,this.DB.addItems([{tableName:"log_day_table",item:f,itemDuration:p}])]):[3,6];case 2:s.sent(),d=0,h=t,s.label=3;case 3:return d<h.length?(g=h[d],[4,this.DB.deleteItemsInRange([{tableName:"logan_detail_table",indexRange:{indexName:"logReportName",onlyIndex:this.logReportNameFormatter(e,g)}}])]):[3,6];case 4:s.sent(),s.label=5;case 5:return d++,[3,3];case 6:return[2]}}))}))},e.idbIsSupported=r.idbIsSupported,e.deleteDB=r.deleteDB,e}();t.b=p},13:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))},o=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=[],i=!1;function u(e){return new Promise((function(t,n){a.push({asyncF:e,resolution:t,rejection:n}),function e(){return r(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:if(!(a.length>0)||i)return[3,5];t=a.shift(),i=!0,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t.asyncF()];case 2:return n=o.sent(),t.resolution(n),[3,4];case 3:return r=o.sent(),t.rejection(r),[3,4];case 4:return i=!1,e(),[3,0];case 5:return[2]}}))}))}()}))}}}]);